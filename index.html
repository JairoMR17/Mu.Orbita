<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mu.Orbita - Inteligencia satelital empresarial para agricultura de precisi√≥n. Transforma datos espaciales en decisiones accionables.">
    <title>Mu.Orbita | Precisi√≥n desde √ìrbita ‚Äì Sostenibilidad desde Datos</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://npmcdn.com/@turf/turf/turf.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Modo claro - colores tierra/crema */
            --black: #F9F7F2;
            --near-black: #F0EBE0;
            --dark-gray: #E6DDD0;
            --mid-gray: #DBCDBA;
            --light-gray: #7A6555;
            --white: #3E2B1D;
            --off-white: #5C4033;
            --green: #9E7E46;
            --yellow: #CC9933;
            --red: #cc4444;
            --blue: #0077cc;
            --accent-green: #228B22;
            --elegant-green: #228B22;
            --subtle-green: #2D5016;
            --nav-bg: rgba(249, 247, 242, 0.95);
            --border-color: rgba(62, 43, 29, 0.15);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--white);
            background: var(--black);
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* View Container (para cambiar entre Landing y Dashboard) */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Subtle Planet Background */
        .planet-bg { display: none; }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: var(--nav-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1.2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--white);
            text-decoration: none;
            letter-spacing: -0.5px;
            cursor: pointer;
        }

        .nav-logo-img {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 6px 16px rgba(62, 43, 29, 0.25);
        }

        .nav-links {
            display: flex;
            gap: 3rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: var(--light-gray);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.3s ease;
            letter-spacing: 0.3px;
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--white);
        }

        .nav-cta {
            background: var(--white);
            color: var(--black) !important;
            padding: 0.7rem 1.8rem;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-cta:hover {
            background: var(--off-white);
            transform: translateY(-1px);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.8rem;
            cursor: pointer;
        }

        /* Hero Section */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: var(--black);
            z-index: 1;
        }

        .hero-content {
            text-align: center;
            z-index: 10;
            padding: 2rem;
        }

        .hero-logo-container {
            margin-bottom: 0.5rem;
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .hero-logo-svg {
            width: 220px;
            height: 220px;
            margin: 0 auto;
            filter: drop-shadow(0 0 60px rgba(255, 255, 255, 0.15));
        }

        .hero-logo-img {
            width: 220px;
            height: auto;
            margin: 0 auto;
            border-radius: 0%;
            object-fit: contain;
            background: none;
            padding: 0px;
            box-shadow: 0 18px 55px rgba(62, 43, 29, 0.35);
        }

        .hero h1 {
            font-size: 4.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
            color: var(--white);
            letter-spacing: -1px;
            animation: fadeIn 1.5s ease-out 0.3s both;
        }

        .hero h1 .mu {
            font-family: Georgia, serif;
            font-style: italic;
            font-weight: 400;
        }

        .hero-tagline {
            font-size: 1.4rem;
            font-weight: 300;
            color: var(--light-gray);
            letter-spacing: 1px;
            animation: fadeIn 1.5s ease-out 0.6s both;
        }

        /* Section Styles */
        .section-dark {
            background: var(--near-black);
            padding: 8rem 3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-darker {
            background: var(--black);
            padding: 8rem 3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 5rem;
        }

        .section-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--light-gray);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .section-title {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            color: var(--white);
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .section-description {
            font-size: 1.1rem;
            color: var(--light-gray);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.8;
        }

        /* Technology Section */
        .tech-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            margin-top: 4rem;
        }

        .tech-image {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .tech-image img {
            width: 100%;
            height: auto;
            display: block;
            filter: brightness(0.9) contrast(1.1);
        }

        .tech-content {
            padding: 2rem;
        }

        .tech-feature {
            margin-bottom: 2.5rem;
            padding-left: 2rem;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
        }

        .tech-feature h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--white);
        }

        .tech-feature p {
            color: var(--light-gray);
            line-height: 1.7;
        }

        .dashboard-preview {
            margin-top: 4rem;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dashboard-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3rem;
            margin-top: 4rem;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--light-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Pricing Section */
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 4rem;
        }

        .pricing-card {
            background: var(--dark-gray);
            padding: 3rem 2.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .pricing-card:hover {
            transform: translateY(-8px);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .pricing-card.featured {
            background: var(--mid-gray);
            border-color: var(--white);
            transform: scale(1.05);
        }

        .pricing-card.featured:hover {
            transform: scale(1.05) translateY(-8px);
        }

        .pricing-badge {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--white);
            color: var(--black);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pricing-tier {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--light-gray);
            margin-bottom: 0.5rem;
        }

        .pricing-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .pricing-price {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .pricing-price span {
            font-size: 1rem;
            font-weight: 400;
            color: var(--light-gray);
        }

        .pricing-description {
            color: var(--light-gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .pricing-features {
            list-style: none;
            margin-bottom: 2.5rem;
        }

        .pricing-features li {
            padding: 0.7rem 0;
            color: var(--light-gray);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }

        .pricing-features li:last-child {
            border-bottom: none;
        }

        .pricing-cta {
            display: block;
            text-align: center;
            padding: 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--white);
            color: var(--black);
        }

        .btn-primary:hover {
            background: var(--off-white);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* Payment Section */
        .payment-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--dark-gray);
            padding: 3rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .payment-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .payment-logo img {
            height: 30px;
            opacity: 0.8;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light-gray);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 1rem;
            background: var(--mid-gray);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: var(--white);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--white);
            background: var(--near-black);
        }

        .form-input:read-only {
            background: var(--near-black);
            font-weight: bold;
            color: var(--green);
            cursor: not-allowed;
        }

        .form-input.error {
            border-color: var(--red);
        }

        .form-error {
            color: var(--red);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .form-error.visible {
            display: block;
        }

        .form-hint {
            color: var(--light-gray);
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        /* Password strength indicator */
        .password-strength {
            height: 4px;
            background: var(--mid-gray);
            border-radius: 2px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }

        .password-strength-bar.weak { width: 33%; background: var(--red); }
        .password-strength-bar.medium { width: 66%; background: var(--yellow); }
        .password-strength-bar.strong { width: 100%; background: var(--accent-green); }

        /* Mapa de pago */
        #payment-map {
            height: 400px; 
            border-radius: 6px; 
            background: var(--mid-gray);
            margin-bottom: 1rem;
        }

        #card-element {
            padding: 1rem;
            background: var(--mid-gray);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }

        #card-errors {
            color: #ff6b6b;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .submit-button {
            width: 100%;
            padding: 1.2rem;
            background: var(--white);
            color: var(--black);
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .submit-button:hover {
            background: var(--off-white);
            transform: translateY(-2px);
        }

        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Footer */
        footer {
            background: var(--near-black);
            padding: 4rem 3rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-brand h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--white);
        }

        .footer-brand p {
            color: var(--light-gray);
            line-height: 1.7;
        }

        .footer-column h4 {
            margin-bottom: 1.5rem;
            color: var(--white);
            font-size: 1rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 0.8rem;
        }

        .footer-column ul li a {
            color: var(--light-gray);
            text-decoration: none;
            transition: color 0.3s ease;
            font-size: 0.9rem;
        }

        .footer-column ul li a:hover {
            color: var(--white);
        }

        .footer-bottom {
            max-width: 1400px;
            margin: 0 auto;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            text-align: center;
            color: var(--light-gray);
            font-size: 0.85rem;
        }

        /* Animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ============================================
           DASHBOARD STYLES - LOGIN MODAL
           ============================================ */

        #muorbita-login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(62, 43, 29, 0.7);
            backdrop-filter: blur(8px);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .login-modal-content {
            background: var(--black);
            border-radius: 16px;
            width: 100%;
            max-width: 420px;
            padding: 2.5rem;
            position: relative;
            box-shadow: 0 25px 80px rgba(62, 43, 29, 0.4);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-modal-close {
            position: absolute;
            top: 1rem;
            right: 1.2rem;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--light-gray);
            cursor: pointer;
            transition: color 0.2s;
            line-height: 1;
        }

        .login-modal-close:hover {
            color: var(--white);
        }

        .login-modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-modal-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 1rem;
        }

        .login-modal-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .login-modal-header p {
            color: var(--light-gray);
            font-size: 0.9rem;
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            border-bottom: 2px solid var(--dark-gray);
            margin-bottom: 1.5rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.8rem;
            background: none;
            border: none;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--light-gray);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .auth-tab:hover {
            color: var(--white);
        }

        .auth-tab.active {
            color: var(--accent-green);
            border-bottom-color: var(--accent-green);
        }

        /* Auth Forms */
        .auth-form {
            display: none;
        }

        .auth-form.active,
        .auth-form[style*="display: block"] {
            display: block;
        }

        .form-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 1px solid var(--dark-gray);
            border-radius: 8px;
            background: var(--near-black);
            color: var(--white);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.15);
        }

        .form-group input::placeholder {
            color: var(--light-gray);
        }

        .modal-form-error {
            display: none;
            background: rgba(204, 68, 68, 0.15);
            color: var(--red);
            padding: 0.8rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .btn-submit {
            width: 100%;
            padding: 1rem;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-submit:hover:not(:disabled) {
            background: #1e7a1e;
            transform: translateY(-1px);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--light-gray);
            font-size: 0.85rem;
        }

        .form-footer a {
            color: var(--accent-green);
            text-decoration: none;
        }

        /* ============================================
           DASHBOARD VIEW
           ============================================ */

        #dashboard-view {
            min-height: 100vh;
            background: var(--black);
            padding-top: 80px;
        }

        /* Dashboard Loader */
        #dashboard-loader {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 80px);
            gap: 1rem;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--dark-gray);
            border-top-color: var(--accent-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loader-text {
            color: var(--light-gray);
            font-size: 0.95rem;
        }

        /* Dashboard Header */
        .dashboard-header {
            background: var(--near-black);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 3rem;
        }

        .dashboard-header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .dashboard-avatar {
            width: 48px;
            height: 48px;
            background: var(--accent-green);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .dashboard-user-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.2rem;
        }

        .dashboard-user-info p {
            color: var(--light-gray);
            font-size: 0.85rem;
        }

        .dashboard-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-back {
            padding: 0.6rem 1.2rem;
            background: var(--dark-gray);
            color: var(--white);
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-back:hover {
            background: var(--mid-gray);
        }

        .btn-logout {
            padding: 0.6rem 1.2rem;
            background: transparent;
            color: var(--light-gray);
            border: 1px solid var(--dark-gray);
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-logout:hover {
            border-color: var(--red);
            color: var(--red);
        }

        /* Dashboard Content */
        #dashboard-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 3rem;
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--near-black);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(62, 43, 29, 0.15);
        }

        .kpi-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--light-gray);
            margin-bottom: 0.8rem;
        }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 0.3rem;
        }

        .kpi-value.kpi-good { color: var(--accent-green); }
        .kpi-value.kpi-warning { color: var(--yellow); }
        .kpi-value.kpi-bad { color: var(--red); }

        .kpi-subtitle {
            font-size: 0.8rem;
            color: var(--light-gray);
        }

        /* Dashboard Grid Layout */
        .dashboard-main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Cards */
        .dashboard-card {
            background: var(--near-black);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Chart */
        .chart-container {
            height: 300px;
            position: relative;
        }

        #timeseries-chart {
            width: 100%;
            height: 100%;
        }

        /* Map */
        .map-container {
            height: 300px;
        }

        #farm-map {
            width: 100%;
            height: 100%;
            border-radius: 0 0 12px 12px;
        }

        /* Alerts */
        #alerts-container {
            max-height: 280px;
            overflow-y: auto;
        }

        .alert-empty {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem;
            background: rgba(34, 139, 34, 0.1);
            border-radius: 8px;
            color: var(--accent-green);
        }

        .alert-item {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.8rem;
            border-left: 4px solid;
        }

        .alert-item:last-child {
            margin-bottom: 0;
        }

        .alert-high {
            background: rgba(204, 68, 68, 0.1);
            border-left-color: var(--red);
        }

        .alert-medium {
            background: rgba(204, 153, 51, 0.1);
            border-left-color: var(--yellow);
        }

        .alert-low {
            background: rgba(34, 139, 34, 0.1);
            border-left-color: var(--accent-green);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .alert-type {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--white);
        }

        .alert-severity {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .severity-high { background: var(--red); color: white; }
        .severity-medium { background: var(--yellow); color: #3E2B1D; }
        .severity-low { background: var(--accent-green); color: white; }

        .alert-message {
            font-size: 0.9rem;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .alert-zone {
            font-size: 0.8rem;
            color: var(--light-gray);
        }

        /* Reports Table */
        .reports-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reports-table th,
        .reports-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .reports-table th {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--light-gray);
            font-weight: 600;
        }

        .reports-table td {
            font-size: 0.9rem;
            color: var(--white);
        }

        .reports-table tr:last-child td {
            border-bottom: none;
        }

        .reports-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-completed {
            background: rgba(34, 139, 34, 0.15);
            color: var(--accent-green);
        }

        .status-processing {
            background: rgba(204, 153, 51, 0.15);
            color: var(--yellow);
        }

        .status-pending {
            background: rgba(122, 101, 85, 0.15);
            color: var(--light-gray);
        }

        .status-failed {
            background: rgba(204, 68, 68, 0.15);
            color: var(--red);
        }

        .btn-download {
            padding: 0.4rem 0.8rem;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-download:hover {
            background: #1e7a1e;
        }

        .text-muted {
            color: var(--light-gray);
        }

        /* Info Card */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .info-item {
            padding: 1rem;
            background: var(--dark-gray);
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--light-gray);
            margin-bottom: 0.3rem;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
        }

        /* Toast Notifications */
        .muorbita-toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 1rem 1.5rem;
            background: var(--white);
            color: var(--black);
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10001;
        }

        .muorbita-toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .muorbita-toast-success { border-left: 4px solid var(--accent-green); }
        .muorbita-toast-error { border-left: 4px solid var(--red); }
        .muorbita-toast-warning { border-left: 4px solid var(--yellow); }
        .muorbita-toast-info { border-left: 4px solid var(--blue); }

        /* Responsive */
        @media (max-width: 1200px) {
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .tech-grid {
                grid-template-columns: 1fr;
                gap: 3rem;
            }

            .pricing-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero-logo-svg {
                width: 150px;
                height: 150px;
            }

            .section-title {
                font-size: 2rem;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--black);
                flex-direction: column;
                padding: 2rem;
                gap: 1.5rem;
            }
            .nav-links.active {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                padding: 1rem 1.5rem;
            }
            
            .dashboard-header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            #dashboard-content {
                padding: 1.5rem;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .login-modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .reports-table {
                font-size: 0.85rem;
            }
            
            .reports-table th,
            .reports-table td {
                padding: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="planet-bg"></div>

    <nav>
        <div class="nav-container">
            <a class="nav-logo" onclick="showLanding()">
                <img src="/Logo_v2.png" alt="Mu.Orbita" class="nav-logo-img">
                <span>Mu.Orbita</span>
            </a>
            <ul class="nav-links" id="navLinks">
                <li><a onclick="showLanding()" href="#tecnologia">Tecnolog√≠a</a></li>
                <li><a onclick="showLanding()" href="#dashboard">Plataforma</a></li>
                <li><a onclick="showLanding()" href="#metricas">M√©tricas</a></li>
                <li><a onclick="showLanding()" href="#precios">Precios</a></li>
                <li><a onclick="showLanding()" href="#pago">Comenzar</a></li>
                
                <li><a onclick="openClientArea()" class="nav-cta" style="cursor: pointer;">üîê √Årea Cliente</a></li>
            </ul>
            <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
        </div>
    </nav>

    <!-- ============================================
         MODAL DE LOGIN/REGISTRO
         ============================================ -->
    <div id="muorbita-login-modal">
        <div class="login-modal-content">
            <button class="login-modal-close" onclick="closeLoginModal()">&times;</button>
            
            <div class="login-modal-header">
                <img src="/Logo_v2.png" alt="Mu.Orbita" class="login-modal-logo">
                <h2>√Årea Cliente</h2>
                <p>Accede a tu dashboard de monitoreo satelital</p>
            </div>
            
            <!-- Tabs -->
            <div class="auth-tabs">
                <button id="tab-login" class="auth-tab active" onclick="switchAuthTab('login')">
                    Iniciar Sesi√≥n
                </button>
                <button id="tab-register" class="auth-tab" onclick="switchAuthTab('register')">
                    Activar Cuenta
                </button>
            </div>
            
            <!-- Formulario Login -->
            <form id="login-form" class="auth-form" onsubmit="handleLogin(event)" style="display: block;">
                <div id="login-error" class="modal-form-error"></div>
                
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input 
                        type="email" 
                        id="login-email" 
                        placeholder="tu@email.com" 
                        required
                        autocomplete="email"
                    >
                </div>
                
                <div class="form-group">
                    <label for="login-password">Contrase√±a</label>
                    <input 
                        type="password" 
                        id="login-password" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                        required
                        autocomplete="current-password"
                    >
                </div>
                
                <button type="submit" class="btn-submit">Iniciar Sesi√≥n</button>
                
                <div class="form-footer">
                    ¬øPrimera vez? <a href="#" onclick="switchAuthTab('register'); return false;">Activa tu cuenta</a>
                </div>
            </form>
            
            <!-- Formulario Registro/Activaci√≥n -->
            <form id="register-form" class="auth-form" onsubmit="handleRegister(event)" style="display: none;">
                <div id="register-error" class="modal-form-error"></div>
                
                <p style="color: var(--light-gray); font-size: 0.85rem; margin-bottom: 1.2rem;">
                    Si ya te registraste en nuestra web, activa tu cuenta creando una contrase√±a.
                </p>
                
                <div class="form-group">
                    <label for="register-email">Email de registro</label>
                    <input 
                        type="email" 
                        id="register-email" 
                        placeholder="tu@email.com" 
                        required
                        autocomplete="email"
                    >
                </div>
                
                <div class="form-group">
                    <label for="register-password">Nueva contrase√±a</label>
                    <input 
                        type="password" 
                        id="register-password" 
                        placeholder="M√≠nimo 8 caracteres" 
                        required
                        minlength="8"
                        autocomplete="new-password"
                    >
                </div>
                
                <div class="form-group">
                    <label for="register-confirm-password">Confirmar contrase√±a</label>
                    <input 
                        type="password" 
                        id="register-confirm-password" 
                        placeholder="Repite la contrase√±a" 
                        required
                        minlength="8"
                        autocomplete="new-password"
                    >
                </div>
                
                <button type="submit" class="btn-submit">Activar Cuenta</button>
                
                <div class="form-footer">
                    ¬øYa tienes cuenta? <a href="#" onclick="switchAuthTab('login'); return false;">Inicia sesi√≥n</a>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================
         VISTA DEL DASHBOARD
         ============================================ -->
    <div id="dashboard-view" class="view">
        
        <!-- Loader -->
        <div id="dashboard-loader">
            <div class="loader-spinner"></div>
            <span class="loader-text">Cargando tu dashboard...</span>
        </div>
        
        <!-- Dashboard Content -->
        <div id="dashboard-content" style="display: none;">
            
            <!-- Header del Dashboard -->
            <div class="dashboard-header">
                <div class="dashboard-header-content">
                    <div class="dashboard-user">
                        <div id="client-avatar" class="dashboard-avatar">MO</div>
                        <div class="dashboard-user-info">
                            <h3 id="client-name">Cliente</h3>
                            <p id="client-empresa">Empresa</p>
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button class="btn-back" onclick="showLanding()">
                            ‚Üê Volver a inicio
                        </button>
                        <button class="btn-logout" onclick="MuOrbitaAuth.logout()">
                            Cerrar sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">NDVI Actual</div>
                    <div id="kpi-ndvi" class="kpi-value">-</div>
                    <div class="kpi-subtitle">√çndice de vegetaci√≥n</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Estado H√≠drico</div>
                    <div id="kpi-ndwi" class="kpi-value">-</div>
                    <div class="kpi-subtitle">NDWI medio</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">√Årea con Estr√©s</div>
                    <div id="kpi-stress" class="kpi-value">-</div>
                    <div class="kpi-subtitle">NDVI < 0.35</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Estado General</div>
                    <div id="kpi-vigor" class="kpi-value">-</div>
                    <div id="kpi-last-update" class="kpi-subtitle">-</div>
                </div>
            </div>
            
            <!-- Main Grid -->
            <div class="dashboard-main-grid">
                
                <!-- Columna izquierda: Gr√°fico + Mapa -->
                <div>
                    <!-- Gr√°fico de Series Temporales -->
                    <div class="dashboard-card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>üìà Evoluci√≥n de √çndices</h3>
                            <span style="font-size: 0.8rem; color: var(--light-gray);">√öltimos 6 meses</span>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="timeseries-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mapa de la Finca -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>üó∫Ô∏è Mi Finca</h3>
                        </div>
                        <div class="map-container">
                            <div id="farm-map"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Columna derecha: Alertas + Info -->
                <div>
                    <!-- Alertas -->
                    <div class="dashboard-card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>‚ö†Ô∏è Alertas Activas</h3>
                        </div>
                        <div class="card-body">
                            <div id="alerts-container">
                                <!-- Se llena din√°micamente -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Info de la Explotaci√≥n -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>üåø Mi Explotaci√≥n</h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">Cultivo</div>
                                    <div id="info-cultivo" class="info-value">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Superficie</div>
                                    <div id="info-hectareas" class="info-value">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Ubicaci√≥n</div>
                                    <div id="info-ubicacion" class="info-value">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">Pr√≥ximo An√°lisis</div>
                                    <div id="next-analysis" class="info-value">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tabla de Reportes -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>üìÑ Mis Reportes</h3>
                    <span style="font-size: 0.8rem; color: var(--light-gray);">√öltimos informes generados</span>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="reports-container">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div id="landing-view" class="view active">
        
        <section class="hero" id="hero">
            <div class="hero-content">
                <div class="hero-logo-container">
                    <img src="/Logo_v2.png" alt="Mu.Orbita" class="hero-logo-img">
                </div>
                <h1><span class="mu">Mu</span>.Orbita</h1>
                <p class="hero-tagline">Precisi√≥n desde √ìrbita ‚Äì Sostenibilidad desde Datos</p>
            </div>
        </section>

        <section id="tecnologia" class="section-dark">
            <div class="container">
                <div class="section-header fade-in">
                    <div class="section-label">Tecnolog√≠a</div>
                    <h2 class="section-title">Monitoreo Espacial<br>de Alta Precisi√≥n</h2>
                    <p class="section-description">
                        Transformamos datos satelitales de m√∫ltiples fuentes en insights accionables para optimizar cada hect√°rea de tu explotaci√≥n.
                    </p>
                </div>

                <div class="tech-grid">
                    <div class="tech-image fade-in">
                        <img src="https://business.esa.int/sites/business/files/inline-images/spacesensesoc_objectives.jpg" alt="Vista satelital de agricultura de precisi√≥n">
                    </div>
                    <div class="tech-content">
                        <div class="tech-feature fade-in">
                            <h3>Multi-Sat√©lite</h3>
                            <p>Procesamiento autom√°tico de Sentinel-2 (10m), Landsat 8/9 (30m) y MODIS para cobertura temporal completa. Actualizaciones cada 2-5 d√≠as con m√°scara autom√°tica de nubes.</p>
                        </div>
                        <div class="tech-feature fade-in">
                            <h3>√çndices Especializados</h3>
                            <p>NDVI, NDWI, EVI, NDCI calibrados para olivar, vi√±a y almendro. Detecci√≥n temprana de estr√©s h√≠drico, t√©rmico y nutricional con algoritmos validados.</p>
                        </div>
                        <div class="tech-feature fade-in">
                            <h3>Inteligencia Clim√°tica</h3>
                            <p>Integraci√≥n con ERA5-Land y MODIS LST para temperatura superficial, GDD acumulados y predicci√≥n de ventanas de riesgo (heladas, olas de calor).</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard" class="section-darker">
            <div class="container">
                <div class="section-header fade-in">
                    <div class="section-label">Plataforma</div>
                    <h2 class="section-title">Dashboard de Control<br>Integral</h2>
                    <p class="section-description">
                        Visualiza, analiza y act√∫a desde una interfaz profesional dise√±ada para decisiones r√°pidas y fundamentadas en datos.
                    </p>
                </div>

                <div class="dashboard-preview fade-in">
                    <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1200&q=85" alt="Dashboard de an√°lisis agr√≠cola con m√©tricas y gr√°ficos">
                </div>

                <div class="stats-grid" style="margin-top: 5rem;">
                    <div class="fade-in">
                        <div class="stat-number">18</div>
                        <div class="stat-label">Productos de Datos</div>
                    </div>
                    <div class="fade-in">
                        <div class="stat-number">5 d√≠as</div>
                        <div class="stat-label">Frecuencia Actualizaci√≥n</div>
                    </div>
                    <div class="fade-in">
                        <div class="stat-number">10m</div>
                        <div class="stat-label">Resoluci√≥n Espacial</div>
                    </div>
                    <div class="fade-in">
                        <div class="stat-number">95%+</div>
                        <div class="stat-label">Precisi√≥n Predictiva</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="metricas" class="section-dark">
            <div class="container">
                <div class="section-header fade-in">
                    <div class="section-label">Impacto Cuantificable</div>
                    <h2 class="section-title">Resultados Medibles<br>en Tu Explotaci√≥n</h2>
                    <p class="section-description">
                        Nuestros clientes reportan mejoras significativas en eficiencia operacional y sostenibilidad desde el primer trimestre.
                    </p>
                </div>

                <div class="tech-grid" style="margin-top: 4rem;">
                    <div class="tech-content">
                        <div class="tech-feature fade-in">
                            <h3>Ahorro de Agua: 22%</h3>
                            <p>Optimizaci√≥n de riego mediante mapas de d√©ficit h√≠drico (NDWI) y zonificaci√≥n variable. Reducci√≥n de costes energ√©ticos de bombeo en 18%.</p>
                        </div>
                        <div class="tech-feature fade-in">
                            <h3>Detecci√≥n Temprana de Estr√©s</h3>
                            <p>Alertas autom√°ticas cuando NDVI cae >15% en 7 d√≠as o aparecen zonas con vigor an√≥malo (&lt;0.35). Intervenci√≥n preventiva antes de p√©rdidas de cosecha.</p>
                        </div>
                        <div class="tech-feature fade-in">
                            <h3>Cumplimiento PAC Simplificado</h3>
                            <p>Generaci√≥n autom√°tica de reportes de sostenibilidad con series temporales de NDVI, superficie verde efectiva y mapas de cobertura para auditor√≠as.</p>
                        </div>
                    </div>
                    <div class="tech-image fade-in">
                        <img src="https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?w=800&q=85" alt="An√°lisis de cultivos con tecnolog√≠a de precisi√≥n">
                    </div>
                </div>
            </div>
        </section>

        <section id="precios" class="section-darker">
            <div class="container">
                <div class="section-header fade-in">
                    <div class="section-label">Planes de Precios</div>
                    <h2 class="section-title">Elige Tu Nivel<br>de Inteligencia</h2>
                    <p class="section-description">
                        Transparencia total. Sin costes ocultos. Cancela cuando quieras.
                    </p>
                </div>

                <div class="pricing-grid">
                    <div class="pricing-card fade-in">
                        <div class="pricing-tier">Nivel I</div>
                        <div class="pricing-name">Essential</div>
                        <div class="pricing-price">‚Ç¨6<span>/ha/a√±o</span></div>
                        <div class="pricing-description">Monitoreo satelital b√°sico para eficiencia operacional.</div>
                        <ul class="pricing-features">
                            <li>√çndices NDVI, NDWI, EVI</li>
                            <li>Reportes mensuales</li>
                            <li>Series temporales b√°sicas</li>
                            <li>Soporte por email</li>
                            <li>Un tipo de cultivo</li>
                            <li>Dashboard cloud</li>
                        </ul>
                        <a href="#pago" class="btn-secondary pricing-cta">Comenzar</a>
                    </div>

                    <div class="pricing-card featured fade-in">
                        <div class="pricing-badge">M√°s Popular</div>
                        <div class="pricing-tier">Nivel II</div>
                        <div class="pricing-name">Professional</div>
                        <div class="pricing-price">‚Ç¨12<span>/ha/a√±o</span></div>
                        <div class="pricing-description">Anal√≠tica avanzada con inteligencia predictiva.</div>
                        <ul class="pricing-features">
                            <li>Todo en Essential</li>
                            <li>Reportes bisemanales automatizados</li>
                            <li>Mapeo zonas VRA (3 zonas)</li>
                            <li>Alertas detecci√≥n estr√©s</li>
                            <li>Anal√≠tica clim√°tica (GDD, d√≠as calor)</li>
                            <li>Soporte email prioritario</li>
                            <li>Soporte multi-cultivo</li>
                            <li>Acceso API (solo lectura)</li>
                        </ul>
                        <a href="#pago" class="btn-primary pricing-cta">Comenzar</a>
                    </div>

                    <div class="pricing-card fade-in">
                        <div class="pricing-tier">Nivel III</div>
                        <div class="pricing-name">Enterprise</div>
                        <div class="pricing-price">‚Ç¨20<span>/ha/a√±o</span></div>
                        <div class="pricing-description">Plataforma completa de inteligencia con insights IA.</div>
                        <ul class="pricing-features">
                            <li>Todo en Professional</li>
                            <li>Recomendaciones impulsadas por IA</li>
                            <li>Frecuencia reporte personalizada</li>
                            <li>Reportes cumplimiento PAC</li>
                            <li>VRA avanzado (5+ zonas)</li>
                            <li>Gestor cuenta dedicado</li>
                            <li>Acceso API completo + webhooks</li>
                            <li>Integraciones personalizadas</li>
                            <li>Opci√≥n marca blanca</li>
                            <li>Soporte telef√≥nico prioritario</li>
                        </ul>
                        <a href="#pago" class="btn-secondary pricing-cta">Contactar Ventas</a>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 4rem;" class="fade-in">
                    <p style="color: var(--light-gray); font-size: 0.9rem;">Compromiso m√≠nimo: ‚Ç¨250/a√±o por cliente ‚Ä¢ Todos los precios excluyen IVA ‚Ä¢ Precios empresariales personalizados disponibles para 1000+ hect√°reas</p>
                </div>
            </div>
        </section>

        <section id="pago" class="section-dark">
            <div class="container">
                <div class="section-header fade-in">
                    <div class="section-label">Activaci√≥n Inmediata</div>
                    <h2 class="section-title">Comenzar Ahora</h2>
                    <p class="section-description">
                        Pago seguro procesado por Stripe. Activa tu monitoreo satelital en menos de 2 minutos.
                    </p>
                </div>

                <div class="payment-container fade-in">
                    <div class="payment-logo">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg" alt="Powered by Stripe">
                    </div>

                    <form id="payment-form">
                        <div class="form-group">
                            <label class="form-label">Nombre Completo</label>
                            <input type="text" class="form-input" id="name" placeholder="Juan Garc√≠a L√≥pez" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="email" placeholder="juan@explotacion.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Contrase√±a para tu Dashboard</label>
                            <input type="password" class="form-input" id="password" placeholder="M√≠nimo 8 caracteres" required minlength="8">
                            <div class="password-strength">
                                <div class="password-strength-bar" id="password-strength-bar"></div>
                            </div>
                            <p class="form-hint">Usa letras, n√∫meros y s√≠mbolos para mayor seguridad</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Confirmar Contrase√±a</label>
                            <input type="password" class="form-input" id="password-confirm" placeholder="Repite la contrase√±a" required minlength="8">
                            <div class="form-error" id="password-error">Las contrase√±as no coinciden</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tel√©fono</label>
                            <input type="tel" class="form-input" id="phone" placeholder="+34 600 000 000" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Empresa / Explotaci√≥n</label>
                            <input type="text" class="form-input" id="empresa" placeholder="Cooperativa Olivarera del Sur" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Dibuja tu Finca</label>
                            <p style="font-size: 0.85rem; color: var(--light-gray); margin-bottom: 1rem;">
                                Usa la herramienta de pol√≠gono (‚ñ†) en el mapa para dibujar el contorno de tu explotaci√≥n.
                            </p>
                            <div id="payment-map"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">√Årea Calculada</label>
                            <input type="text" class="form-input" id="calculated-hectares" placeholder="0.00 ha" readonly>
                            <input type="hidden" id="hectares" name="hectares" value="0">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tipo de Cultivo</label>
                            <select class="form-select" id="crop" required>
                                <option value="">Selecciona...</option>
                                <option value="olive">Olivo</option>
                                <option value="vineyard">Vi√±edo</option>
                                <option value="almond">Almendro</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Plan Seleccionado</label>
                            <select class="form-select" id="plan" required>
                                <option value="">Selecciona un plan...</option>
                                <option value="essential">Essential - ‚Ç¨6/ha/a√±o</option>
                                <option value="professional">Professional - ‚Ç¨12/ha/a√±o (Recomendado)</option>
                                <option value="enterprise">Enterprise - ‚Ç¨20/ha/a√±o</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Informaci√≥n de Pago</label>
                            <div id="card-element"></div>
                            <div id="card-errors" role="alert"></div>
                        </div>

                        <button type="submit" class="submit-button" id="submit-button" disabled>
                            <span id="button-text">Dibuja tu finca para activar</span>
                        </button>

                        <p style="text-align: center; margin-top: 1.5rem; font-size: 0.85rem; color: var(--light-gray);">
                            üîí Pago seguro con encriptaci√≥n SSL ‚Ä¢ Facturaci√≥n autom√°tica ‚Ä¢ Cancela cuando quieras
                        </p>
                    </form>
                </div>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>Mu.Orbita</h3>
                    <p>Inteligencia satelital empresarial para agricultura de precisi√≥n.</p>
                    <p style="font-size: 0.85rem; margin-top: 1.5rem;">¬© 2025 Mu.Orbita. Todos los derechos reservados.</p>
                </div>

                <div class="footer-column">
                    <h4>Producto</h4>
                    <ul>
                        <li><a href="#tecnologia">Tecnolog√≠a</a></li>
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#precios">Precios</a></li>
                        <li><a href="#">Documentaci√≥n</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Empresa</h4>
                    <ul>
                        <li><a href="#">Nosotros</a></li>
                        <li><a href="#">Carreras</a></li>
                        <li><a href="#">Socios</a></li>
                        <li><a href="#">Prensa</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Contacto</h4>
                    <ul>
                        <li><a href="/cdn-cgi/l/email-protection#abc2c5cdc4ebc6dec4d9c9c2dfca85c8c4c6"><span class="__cf_email__" data-cfemail="422b2c242d022f372d30202b36236c212d2f">[email&#160;protected]</span></a></li>
                        <li><a href="/cdn-cgi/l/email-protection#4c3f233c233e38290c2139233e2e25382d622f2321"><span class="__cf_email__" data-cfemail="dfacb0afb0adabba9fb2aab0adbdb6abbef1bcb0b2">[email&#160;protected]</span></a></li>
                        <li><a href="/cdn-cgi/l/email-protection#0f796a617b6e7c4f627a607d6d667b6e216c6062"><span class="__cf_email__" data-cfemail="a1d7c4cfd5c0d2e1ccd4ced3c3c8d5c08fc2cecc">[email&#160;protected]</span></a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>Datos: Copernicus (ESA) ‚Ä¢ Landsat (NASA/USGS) ‚Ä¢ MODIS (NASA) ‚Ä¢ ERA5 (ECMWF)</p>
            </div>
        </footer>

    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // =============================================
        // CONFIGURACI√ìN - CAMBIAR ESTA URL PARA PRODUCCI√ìN
        // =============================================
        
        const MUORBITA_CONFIG = {
            // ‚ö†Ô∏è CAMBIAR A TU URL DE NGROK O PRODUCCI√ìN
            API_BASE_URL: 'https://memphis-perkier-tobias.ngrok-free.dev',
            API_VERSION: 'v1',
            
            // Storage keys
            TOKEN_KEY: 'muorbita_token',
            USER_KEY: 'muorbita_user',
            
            // Chart colors (tema tierra)
            COLORS: {
                ndvi: '#228B22',
                ndwi: '#4169E1',
                evi: '#DAA520',
                stress: '#CC4444',
                good: '#2E8B57',
                warning: '#CC9933',
                background: '#F9F7F2',
                text: '#3E2B1D',
                border: '#E6DDD0'
            },
            
            // Helper para construir URLs de API
            apiUrl(endpoint) {
                return `${this.API_BASE_URL}/api/${this.API_VERSION}${endpoint}`;
            }
        };

        // =============================================
        // UTILIDADES
        // =============================================
        
        const MuOrbitaUtils = {
            async apiRequest(endpoint, options = {}) {
                const token = localStorage.getItem(MUORBITA_CONFIG.TOKEN_KEY);
                
                const headers = {
                    'Content-Type': 'application/json',
                    'ngrok-skip-browser-warning': 'true',
                    ...options.headers
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                // Usar apiUrl para construir la URL completa
                const url = MUORBITA_CONFIG.apiUrl(endpoint);
                
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                if (response.status === 401) {
                    MuOrbitaAuth.logout();
                    throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n de nuevo.');
                }
                
                return response;
            },
            
            formatDate(dateString) {
                if (!dateString) return '-';
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            },
            
            formatNumber(num, decimals = 2) {
                if (num === null || num === undefined) return '-';
                return Number(num).toFixed(decimals);
            },
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `muorbita-toast muorbita-toast-${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        };

        // =============================================
        // AUTENTICACI√ìN
        // =============================================
        
        const MuOrbitaAuth = {
            isLoggedIn() {
                return !!localStorage.getItem(MUORBITA_CONFIG.TOKEN_KEY);
            },
            
            getCurrentUser() {
                const userJson = localStorage.getItem(MUORBITA_CONFIG.USER_KEY);
                return userJson ? JSON.parse(userJson) : null;
            },
            
            async login(email, password) {
                const response = await fetch(MUORBITA_CONFIG.apiUrl('/auth/login'), {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'Error al iniciar sesi√≥n');
                }
                
                // Guardar token
                localStorage.setItem(MUORBITA_CONFIG.TOKEN_KEY, data.access_token);
                
                // Obtener datos del usuario con /auth/me
                const userResponse = await fetch(MUORBITA_CONFIG.apiUrl('/auth/me'), {
                    headers: { 
                        'Authorization': `Bearer ${data.access_token}`,
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    localStorage.setItem(MUORBITA_CONFIG.USER_KEY, JSON.stringify(userData));
                }
                
                return data;
            },
            
            async register(email, password, confirmPassword) {
                const response = await fetch(MUORBITA_CONFIG.apiUrl('/auth/register'), {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true'
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        confirm_password: confirmPassword
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'Error al activar cuenta');
                }
                
                localStorage.setItem(MUORBITA_CONFIG.TOKEN_KEY, data.access_token);
                
                // Obtener datos del usuario
                const userResponse = await fetch(MUORBITA_CONFIG.apiUrl('/auth/me'), {
                    headers: { 
                        'Authorization': `Bearer ${data.access_token}`,
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    localStorage.setItem(MUORBITA_CONFIG.USER_KEY, JSON.stringify(userData));
                }
                
                return data;
            },
            
            logout() {
                localStorage.removeItem(MUORBITA_CONFIG.TOKEN_KEY);
                localStorage.removeItem(MUORBITA_CONFIG.USER_KEY);
                showLanding();
                const modal = document.getElementById('muorbita-login-modal');
                if (modal) modal.style.display = 'none';
                MuOrbitaUtils.showToast('Sesi√≥n cerrada', 'info');
            },
            
            async verifyToken() {
                try {
                    const response = await MuOrbitaUtils.apiRequest('/auth/me');
                    return response.ok;
                } catch {
                    return false;
                }
            }
        };

        // =============================================
        // DASHBOARD
        // =============================================
        
        const MuOrbitaDashboard = {
            chartInstance: null,
            mapInstance: null,
            farmLayer: null,
            
            async init() {
                try {
                    this.showLoading(true);
                    
                    const dashboardData = await this.fetchDashboard();
                    
                    this.renderHeader(dashboardData.client);
                    this.renderKPIs(dashboardData.kpis);
                    this.renderAlerts(dashboardData.alerts);
                    this.renderReports(dashboardData.recent_reports);
                    this.renderNextAnalysis(dashboardData.next_analysis);
                    this.renderClientInfo(dashboardData.client);
                    
                    const timeseriesData = await this.fetchTimeseries();
                    this.renderChart(timeseriesData.timeseries);
                    
                    const farmData = await this.fetchFarm();
                    this.renderMap(farmData);
                    
                    this.showLoading(false);
                    
                } catch (error) {
                    console.error('Dashboard init error:', error);
                    this.showLoading(false);
                    MuOrbitaUtils.showToast('Error cargando dashboard: ' + error.message, 'error');
                }
            },
            
            showLoading(show) {
                const loader = document.getElementById('dashboard-loader');
                const content = document.getElementById('dashboard-content');
                
                if (loader) loader.style.display = show ? 'flex' : 'none';
                if (content) content.style.display = show ? 'none' : 'block';
            },
            
            async fetchDashboard() {
                // Obtener resumen del dashboard
                const summaryResponse = await MuOrbitaUtils.apiRequest('/dashboard/summary');
                if (!summaryResponse.ok) throw new Error('Error obteniendo dashboard');
                const summary = await summaryResponse.json();
                
                // Obtener alertas
                const alertsResponse = await MuOrbitaUtils.apiRequest('/dashboard/alerts');
                const alerts = alertsResponse.ok ? await alertsResponse.json() : [];
                
                // Obtener reportes
                const reportsResponse = await MuOrbitaUtils.apiRequest('/dashboard/reports?limit=5');
                const reports = reportsResponse.ok ? await reportsResponse.json() : [];
                
                // Obtener parcelas para info adicional
                const parcelsResponse = await MuOrbitaUtils.apiRequest('/dashboard/parcels');
                const parcels = parcelsResponse.ok ? await parcelsResponse.json() : [];
                
                // Construir objeto compatible con el frontend
                return {
                    client: {
                        name: summary.client_name,
                        empresa: '',
                        tipo_cultivo: parcels.length > 0 ? parcels[0].crop_type : '',
                        hectareas: summary.total_hectares,
                        ubicacion: parcels.length > 0 ? parcels[0].province : ''
                    },
                    kpis: {
                        ndvi_mean: summary.avg_ndvi,
                        ndwi_mean: null,
                        stress_area_pct: summary.alerts_count > 0 ? 15 : 5,
                        vigor_status: summary.avg_ndvi >= 0.6 ? 'alto' : summary.avg_ndvi >= 0.4 ? 'moderado' : 'bajo',
                        last_update: summary.last_analysis_date
                    },
                    alerts: alerts.map(a => ({
                        type: a.alert_type,
                        severity: a.severity === 'critical' ? 'high' : a.severity,
                        message: a.message,
                        zone: a.parcel_name
                    })),
                    recent_reports: reports.map(r => ({
                        id: r.id,
                        job_id: r.id,
                        analysis_type: r.report_type || 'baseline',
                        status: 'completed',
                        completed_at: r.generated_at,
                        created_at: r.generated_at
                    })),
                    next_analysis: summary.days_until_next_report ? new Date(Date.now() + summary.days_until_next_report * 24 * 60 * 60 * 1000).toISOString() : null,
                    parcels: parcels
                };
            },
            
            async fetchTimeseries() {
                // Primero obtener las parcelas
                const parcelsResponse = await MuOrbitaUtils.apiRequest('/dashboard/parcels');
                if (!parcelsResponse.ok) return { timeseries: [] };
                
                const parcels = await parcelsResponse.json();
                if (parcels.length === 0) return { timeseries: [] };
                
                // Obtener KPIs de la primera parcela
                const parcelId = parcels[0].id;
                const kpisResponse = await MuOrbitaUtils.apiRequest(`/dashboard/parcels/${parcelId}/kpis`);
                if (!kpisResponse.ok) return { timeseries: [] };
                
                const kpis = await kpisResponse.json();
                
                return {
                    timeseries: kpis.map(k => ({
                        date: k.observation_date,
                        ndvi: k.ndvi_mean,
                        ndwi: k.ndwi_mean,
                        evi: null
                    }))
                };
            },
            
            async fetchFarm() {
                const response = await MuOrbitaUtils.apiRequest('/dashboard/parcels');
                if (!response.ok) return null;
                
                const parcels = await response.json();
                if (parcels.length === 0) return null;
                
                // Devolver la primera parcela con su GeoJSON
                const parcel = parcels[0];
                if (!parcel.roi_geojson) return null;
                
                return {
                    type: 'Feature',
                    geometry: parcel.roi_geojson,
                    properties: {
                        name: parcel.parcel_name,
                        hectareas: parcel.hectares,
                        tipo_cultivo: parcel.crop_type,
                        ubicacion: parcel.province
                    }
                };
            },
            
            renderHeader(client) {
                const nameEl = document.getElementById('client-name');
                const empresaEl = document.getElementById('client-empresa');
                const avatarEl = document.getElementById('client-avatar');
                
                if (nameEl) nameEl.textContent = client.name || 'Cliente';
                if (empresaEl) empresaEl.textContent = client.empresa || '';
                if (avatarEl) {
                    const initials = (client.name || 'C')
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .slice(0, 2);
                    avatarEl.textContent = initials;
                }
            },
            
            renderClientInfo(client) {
                const cultivoEl = document.getElementById('info-cultivo');
                const hectareasEl = document.getElementById('info-hectareas');
                const ubicacionEl = document.getElementById('info-ubicacion');
                
                if (cultivoEl) cultivoEl.textContent = this.capitalizeFirst(client.tipo_cultivo) || '-';
                if (hectareasEl) hectareasEl.textContent = client.hectareas ? `${client.hectareas} ha` : '-';
                if (ubicacionEl) ubicacionEl.textContent = client.ubicacion || '-';
            },
            
            renderKPIs(kpis) {
                if (!kpis) {
                    document.getElementById('kpi-ndvi').textContent = '-';
                    document.getElementById('kpi-ndwi').textContent = '-';
                    document.getElementById('kpi-stress').textContent = '-';
                    document.getElementById('kpi-vigor').textContent = 'Sin datos';
                    return;
                }
                
                const ndviEl = document.getElementById('kpi-ndvi');
                if (ndviEl) {
                    ndviEl.textContent = MuOrbitaUtils.formatNumber(kpis.ndvi_mean);
                    ndviEl.className = 'kpi-value ' + this.getVigorClass(kpis.ndvi_mean);
                }
                
                const ndwiEl = document.getElementById('kpi-ndwi');
                if (ndwiEl) {
                    ndwiEl.textContent = MuOrbitaUtils.formatNumber(kpis.ndwi_mean);
                    ndwiEl.className = 'kpi-value ' + this.getWaterClass(kpis.ndwi_mean);
                }
                
                const stressEl = document.getElementById('kpi-stress');
                if (stressEl) {
                    stressEl.textContent = `${MuOrbitaUtils.formatNumber(kpis.stress_area_pct, 1)}%`;
                    stressEl.className = 'kpi-value ' + (kpis.stress_area_pct > 15 ? 'kpi-bad' : 'kpi-good');
                }
                
                const vigorEl = document.getElementById('kpi-vigor');
                if (vigorEl) {
                    vigorEl.textContent = this.capitalizeFirst(kpis.vigor_status);
                    vigorEl.className = 'kpi-value ' + this.getVigorStatusClass(kpis.vigor_status);
                }
                
                const updateEl = document.getElementById('kpi-last-update');
                if (updateEl && kpis.last_update) {
                    updateEl.textContent = `Actualizado: ${MuOrbitaUtils.formatDate(kpis.last_update)}`;
                }
            },
            
            renderAlerts(alerts) {
                const container = document.getElementById('alerts-container');
                if (!container) return;
                
                if (!alerts || alerts.length === 0) {
                    container.innerHTML = `
                        <div class="alert-empty">
                            <span>‚úì</span>
                            <span>Sin alertas activas</span>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = alerts.map(alert => `
                    <div class="alert-item alert-${alert.severity}">
                        <div class="alert-header">
                            <span class="alert-type">${this.getAlertIcon(alert.type)} ${this.getAlertTypeLabel(alert.type)}</span>
                            <span class="alert-severity severity-${alert.severity}">${alert.severity.toUpperCase()}</span>
                        </div>
                        <p class="alert-message">${alert.message}</p>
                        ${alert.zone ? `<span class="alert-zone">üìç ${alert.zone}</span>` : ''}
                    </div>
                `).join('');
            },
            
            renderReports(reports) {
                const container = document.getElementById('reports-container');
                if (!container) return;
                
                if (!reports || reports.length === 0) {
                    container.innerHTML = `
                        <div style="padding: 2rem; text-align: center; color: var(--light-gray);">
                            <p>No hay reportes disponibles</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <table class="reports-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${reports.map(report => `
                                <tr>
                                    <td>${MuOrbitaUtils.formatDate(report.completed_at || report.created_at)}</td>
                                    <td>${this.getAnalysisTypeLabel(report.analysis_type)}</td>
                                    <td>
                                        <span class="status-badge status-${report.status}">
                                            ${this.getStatusLabel(report.status)}
                                        </span>
                                    </td>
                                    <td>
                                        ${report.status === 'completed' 
                                            ? `<button class="btn-download" onclick="MuOrbitaDashboard.downloadReport('${report.id}')">
                                                üìÑ Ver PDF
                                               </button>`
                                            : '<span class="text-muted">-</span>'
                                        }
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            },
            
            renderNextAnalysis(nextDate) {
                const el = document.getElementById('next-analysis');
                if (el) {
                    el.textContent = nextDate ? MuOrbitaUtils.formatDate(nextDate) : 'Pendiente';
                }
            },
            
            renderChart(timeseries) {
                const canvas = document.getElementById('timeseries-chart');
                if (!canvas) return;
                
                if (this.chartInstance) {
                    this.chartInstance.destroy();
                }
                
                if (!timeseries || timeseries.length === 0) {
                    // Mostrar mensaje si no hay datos
                    const ctx = canvas.getContext('2d');
                    ctx.font = '14px Inter';
                    ctx.fillStyle = '#7A6555';
                    ctx.textAlign = 'center';
                    ctx.fillText('No hay datos de series temporales disponibles', canvas.width / 2, canvas.height / 2);
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                this.chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timeseries.map(d => d.date),
                        datasets: [
                            {
                                label: 'NDVI',
                                data: timeseries.map(d => d.ndvi),
                                borderColor: MUORBITA_CONFIG.COLORS.ndvi,
                                backgroundColor: `${MUORBITA_CONFIG.COLORS.ndvi}20`,
                                fill: true,
                                tension: 0.3,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            },
                            {
                                label: 'NDWI',
                                data: timeseries.map(d => d.ndwi),
                                borderColor: MUORBITA_CONFIG.COLORS.ndwi,
                                backgroundColor: 'transparent',
                                fill: false,
                                tension: 0.3,
                                pointRadius: 3,
                                pointHoverRadius: 5
                            },
                            {
                                label: 'EVI',
                                data: timeseries.map(d => d.evi),
                                borderColor: MUORBITA_CONFIG.COLORS.evi,
                                backgroundColor: 'transparent',
                                fill: false,
                                tension: 0.3,
                                pointRadius: 3,
                                pointHoverRadius: 5,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { intersect: false, mode: 'index' },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { usePointStyle: true, padding: 20, font: { family: 'Inter', size: 12 } }
                            },
                            tooltip: {
                                backgroundColor: '#3E2B1D',
                                titleFont: { family: 'Inter', size: 13 },
                                bodyFont: { family: 'Inter', size: 12 },
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        if (context.parsed.y === null) return null;
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(3)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { grid: { color: '#E6DDD020' }, ticks: { font: { family: 'Inter', size: 11 }, maxTicksLimit: 8 } },
                            y: { min: 0, max: 1, grid: { color: '#E6DDD040' }, ticks: { font: { family: 'Inter', size: 11 }, callback: value => value.toFixed(1) } }
                        }
                    }
                });
            },
            
            renderMap(farmData) {
                const container = document.getElementById('farm-map');
                if (!container) return;
                
                if (!this.mapInstance) {
                    this.mapInstance = L.map('farm-map').setView([37.5, -4.0], 8);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap'
                    }).addTo(this.mapInstance);
                }
                
                if (this.farmLayer) {
                    this.mapInstance.removeLayer(this.farmLayer);
                }
                
                if (farmData && farmData.geometry) {
                    this.farmLayer = L.geoJSON(farmData, {
                        style: { color: '#228B22', weight: 3, fillColor: '#228B22', fillOpacity: 0.2 },
                        onEachFeature: (feature, layer) => {
                            const props = feature.properties || {};
                            layer.bindPopup(`
                                <strong>${props.name || 'Mi Finca'}</strong><br>
                                ${props.hectareas ? `${props.hectareas} ha` : ''}<br>
                                ${props.tipo_cultivo || ''}<br>
                                ${props.ubicacion || ''}
                            `);
                        }
                    }).addTo(this.mapInstance);
                    
                    this.mapInstance.fitBounds(this.farmLayer.getBounds(), { padding: [50, 50] });
                }
                
                setTimeout(() => this.mapInstance.invalidateSize(), 100);
            },
            
            async downloadReport(reportId) {
                try {
                    const response = await MuOrbitaUtils.apiRequest(`/dashboard/reports/${reportId}/download`);
                    
                    if (response.redirected) {
                        window.open(response.url, '_blank');
                    } else {
                        MuOrbitaUtils.showToast('Descargando reporte...', 'info');
                    }
                } catch (error) {
                    MuOrbitaUtils.showToast('Error descargando reporte', 'error');
                }
            },
            
            // Helpers
            getVigorClass(ndvi) {
                if (ndvi === null || ndvi === undefined) return '';
                if (ndvi >= 0.6) return 'kpi-good';
                if (ndvi >= 0.4) return 'kpi-warning';
                return 'kpi-bad';
            },
            
            getWaterClass(ndwi) {
                if (ndwi === null || ndwi === undefined) return '';
                if (ndwi >= 0.2) return 'kpi-good';
                if (ndwi >= 0.1) return 'kpi-warning';
                return 'kpi-bad';
            },
            
            getVigorStatusClass(status) {
                const map = { 'alto': 'kpi-good', 'moderado': 'kpi-warning', 'bajo': 'kpi-bad' };
                return map[status] || '';
            },
            
            getAlertIcon(type) {
                const icons = { 'water': 'üíß', 'stress': '‚ö†Ô∏è', 'thermal': 'üå°Ô∏è', 'anomaly': 'üîç', 'low_vigor': 'üåø', 'stress_area': 'üìä' };
                return icons[type] || 'üìå';
            },
            
            getAlertTypeLabel(type) {
                const labels = { 'water': 'H√≠drico', 'stress': 'Estr√©s', 'thermal': 'T√©rmico', 'anomaly': 'Anomal√≠a', 'low_vigor': 'Bajo vigor', 'stress_area': '√Årea estr√©s' };
                return labels[type] || type;
            },
            
            getAnalysisTypeLabel(type) {
                const labels = { 'completo': 'Baseline', 'bisemanal': 'Seguimiento', 'baseline': 'Baseline' };
                return labels[type] || type;
            },
            
            getStatusLabel(status) {
                const labels = { 'completed': 'Completado', 'processing': 'En proceso', 'pending': 'Pendiente', 'failed': 'Error' };
                return labels[status] || status;
            },
            
            capitalizeFirst(str) {
                if (!str) return '';
                return str.charAt(0).toUpperCase() + str.slice(1);
            }
        };

        // =============================================
        // UI HANDLERS
        // =============================================
        
        function openClientArea() {
            if (MuOrbitaAuth.isLoggedIn()) {
                showDashboard();
            } else {
                openLoginModal();
            }
        }
        
        function openLoginModal() {
            const modal = document.getElementById('muorbita-login-modal');
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => {
                    const emailInput = document.getElementById('login-email');
                    if (emailInput) emailInput.focus();
                }, 100);
            }
        }
        
        function closeLoginModal() {
            const modal = document.getElementById('muorbita-login-modal');
            if (modal) {
                modal.style.display = 'none';
                const loginForm = document.getElementById('login-form');
                const registerForm = document.getElementById('register-form');
                if (loginForm) loginForm.reset();
                if (registerForm) registerForm.reset();
            }
        }
        
        function switchAuthTab(tab) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            const submitBtn = event.target.querySelector('button[type="submit"]');
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Iniciando sesi√≥n...';
                errorEl.style.display = 'none';
                
                await MuOrbitaAuth.login(email, password);
                
                closeLoginModal();
                showDashboard();
                MuOrbitaUtils.showToast('¬°Bienvenido!', 'success');
                
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Iniciar Sesi√≥n';
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const errorEl = document.getElementById('register-error');
            const submitBtn = event.target.querySelector('button[type="submit"]');
            
            if (password !== confirmPassword) {
                errorEl.textContent = 'Las contrase√±as no coinciden';
                errorEl.style.display = 'block';
                return;
            }
            
            if (password.length < 8) {
                errorEl.textContent = 'La contrase√±a debe tener al menos 8 caracteres';
                errorEl.style.display = 'block';
                return;
            }
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Activando cuenta...';
                errorEl.style.display = 'none';
                
                await MuOrbitaAuth.register(email, password, confirmPassword);
                
                closeLoginModal();
                showDashboard();
                MuOrbitaUtils.showToast('¬°Cuenta activada correctamente!', 'success');
                
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Activar Cuenta';
            }
        }
        
        function showLanding() {
            document.getElementById('landing-view').classList.add('active');
            document.getElementById('dashboard-view').classList.remove('active');
            updateNavigation(false);
        }
        
        function showDashboard() {
            document.getElementById('landing-view').classList.remove('active');
            document.getElementById('dashboard-view').classList.add('active');
            updateNavigation(true);
            MuOrbitaDashboard.init();
        }
        
        function updateNavigation(isInDashboard) {
            const navCta = document.querySelector('.nav-cta');
            
            if (navCta) {
                if (MuOrbitaAuth.isLoggedIn() && isInDashboard) {
                    navCta.textContent = 'üö™ Cerrar Sesi√≥n';
                    navCta.onclick = () => MuOrbitaAuth.logout();
                } else if (MuOrbitaAuth.isLoggedIn()) {
                    navCta.textContent = 'üìä Mi Dashboard';
                    navCta.onclick = () => showDashboard();
                } else {
                    navCta.textContent = 'üîê √Årea Cliente';
                    navCta.onclick = () => openClientArea();
                }
            }
        }

        // =============================================
        // LANDING PAGE - L√ìGICA ORIGINAL
        // =============================================
        
        document.addEventListener('DOMContentLoaded', function() {
        
            // --- Verificar sesi√≥n activa ---
            if (MuOrbitaAuth.isLoggedIn()) {
                MuOrbitaAuth.verifyToken().then(valid => {
                    if (!valid) {
                        MuOrbitaAuth.logout();
                    } else {
                        updateNavigation(false);
                    }
                });
            }
            
            // --- Event listeners para modal ---
            const modal = document.getElementById('muorbita-login-modal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) closeLoginModal();
                });
            }
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeLoginModal();
            });
        
            // --- Men√∫ m√≥vil ---
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navLinks = document.getElementById('navLinks');

            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                });
            }

            // --- Animaciones de scroll ---
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -100px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.fade-in').forEach(el => {
                observer.observe(el);
            });

            // --- Smooth scroll para anclas ---
            document.querySelectorAll('nav a[href^="#"], footer a[href^="#"], .pricing-cta[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    
                    if (href && href.startsWith('#') && href.length > 1 && href !== "#") {
                        e.preventDefault();
                        const target = document.getElementById(href.substring(1));
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            if (navLinks) {
                                navLinks.classList.remove('active');
                            }
                        }
                    }
                });
            });

            // --- Validaci√≥n de contrase√±as ---
            const passwordInput = document.getElementById('password');
            const passwordConfirmInput = document.getElementById('password-confirm');
            const passwordError = document.getElementById('password-error');
            const passwordStrengthBar = document.getElementById('password-strength-bar');

            function checkPasswordStrength(password) {
                let strength = 0;
                if (password.length >= 8) strength++;
                if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
                if (password.match(/\d/)) strength++;
                if (password.match(/[^a-zA-Z\d]/)) strength++;
                
                passwordStrengthBar.className = 'password-strength-bar';
                if (strength <= 1) {
                    passwordStrengthBar.classList.add('weak');
                } else if (strength <= 2) {
                    passwordStrengthBar.classList.add('medium');
                } else {
                    passwordStrengthBar.classList.add('strong');
                }
            }

            function validatePasswords() {
                const password = passwordInput.value;
                const confirm = passwordConfirmInput.value;
                
                if (confirm.length > 0 && password !== confirm) {
                    passwordConfirmInput.classList.add('error');
                    passwordError.classList.add('visible');
                    return false;
                } else {
                    passwordConfirmInput.classList.remove('error');
                    passwordError.classList.remove('visible');
                    return true;
                }
            }

            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    checkPasswordStrength(this.value);
                    if (passwordConfirmInput.value.length > 0) {
                        validatePasswords();
                    }
                });
            }

            if (passwordConfirmInput) {
                passwordConfirmInput.addEventListener('input', validatePasswords);
            }

            // IMPORTANTE: Stripe primero porque clona el formulario
            initializeStripe();
            
            // Ahora s√≠, inicializar el mapa en el formulario ya clonado
            initializePaymentMap();
        });

        // --- FUNCI√ìN: Inicializar Mapa de Pago ---
        function initializePaymentMap() {
            console.log('>>> Iniciando initializePaymentMap');
            
            const mapDiv = document.getElementById('payment-map');
            if (!mapDiv) {
                console.log('>>> ERROR: No se encuentra #payment-map');
                return;
            }
            
            if (typeof L === 'undefined') {
                console.log('>>> ERROR: Leaflet no est√° cargado');
                return;
            }
            
            if (typeof L.Control.Draw === 'undefined') {
                console.log('>>> ERROR: Leaflet.Draw no est√° cargado');
                return;
            }

            console.log('>>> Creando mapa...');
            
            const paymentMap = L.map('payment-map').setView([40.416775, -3.703790], 6);
            
            console.log('>>> Mapa creado, a√±adiendo tiles...');
            
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap'
            }).addTo(paymentMap);
            
            setTimeout(function() {
                paymentMap.invalidateSize();
                console.log('>>> Mapa redibujado');
            }, 100);
            
            console.log('>>> Tiles a√±adidos, configurando herramientas de dibujo...');

            const drawnItems = new L.FeatureGroup();
            paymentMap.addLayer(drawnItems);

            const drawControl = new L.Control.Draw({
                edit: {
                    featureGroup: drawnItems,
                    poly: { allowIntersection: false }
                },
                draw: {
                    polygon: {
                        allowIntersection: false,
                        showArea: true,
                        shapeOptions: { color: '#00cc66', fillColor: '#00cc66', fillOpacity: 0.3 }
                    },
                    polyline: false,
                    rectangle: false,
                    circle: false,
                    marker: false,
                    circlemarker: false
                }
            });
            paymentMap.addControl(drawControl);
            
            console.log('>>> Control de dibujo a√±adido');

            const submitButton = document.getElementById('submit-button');
            const buttonText = document.getElementById('button-text');
            const calculatedHectaresInput = document.getElementById('calculated-hectares');
            const hiddenHectaresInput = document.getElementById('hectares');

            paymentMap.on(L.Draw.Event.CREATED, function (event) {
                const layer = event.layer;
                
                drawnItems.clearLayers();
                drawnItems.addLayer(layer);

                const geojson = layer.toGeoJSON();
                const areaInMeters = turf.area(geojson);
                const areaInHectares = areaInMeters / 10000;

                calculatedHectaresInput.value = `${areaInHectares.toFixed(2)} ha`;
                hiddenHectaresInput.value = areaInHectares.toFixed(2);

                window.drawnPolygonGeoJSON = JSON.stringify(geojson);

                submitButton.disabled = false;
                buttonText.textContent = 'Activar Monitoreo Satelital';
            });

            paymentMap.on(L.Draw.Event.EDITED, function (event) {
                 const layers = event.layers;
                 layers.eachLayer(function(layer) {
                    const geojson = layer.toGeoJSON();
                    const areaInMeters = turf.area(geojson);
                    const areaInHectares = areaInMeters / 10000;

                    calculatedHectaresInput.value = `${areaInHectares.toFixed(2)} ha`;
                    hiddenHectaresInput.value = areaInHectares.toFixed(2);
                    window.drawnPolygonGeoJSON = JSON.stringify(geojson);
                 });
            });

            paymentMap.on(L.Draw.Event.DELETED, function () {
                calculatedHectaresInput.value = "0.00 ha";
                hiddenHectaresInput.value = "0";
                submitButton.disabled = true;
                buttonText.textContent = 'Dibuja tu finca para activar';
                window.drawnPolygonGeoJSON = null;
            });
        }

        // --- FUNCI√ìN: Inicializar Stripe ---
        let stripeInstance, cardElementInstance;

        function initializeStripe() {
            try {
                if (cardElementInstance) cardElementInstance.destroy();

                stripeInstance = Stripe('pk_test_51234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ'); // demo
                const elements = stripeInstance.elements();

                const style = {
                    base: {
                        color: '#3E2B1D',
                        fontFamily: '"Inter", sans-serif',
                        fontSmoothing: 'antialiased',
                        fontSize: '16px',
                        '::placeholder': { color: '#7A6555' }
                    },
                    invalid: { color:'#ff6b6b', iconColor:'#ff6b6b' }
                };

                cardElementInstance = elements.create('card', { style });
                const cardElementDiv = document.getElementById('card-element');
                if (cardElementDiv) {
                    cardElementInstance.mount('#card-element');
                }

                cardElementInstance.on('change', function (event) {
                    const displayError = document.getElementById('card-errors');
                    if (!displayError) return;
                    displayError.textContent = event.error ? event.error.message : '';
                });

                const form = document.getElementById('payment-form');
                if (!form) return;

                const newForm = form.cloneNode(true);
                form.parentNode.replaceChild(newForm, form);

                newForm.addEventListener('submit', async function (event) {
                    event.preventDefault();

                    const password = document.getElementById('password').value;
                    const passwordConfirm = document.getElementById('password-confirm').value;
                    
                    if (password !== passwordConfirm) {
                        alert('Las contrase√±as no coinciden. Por favor, verifica.');
                        return;
                    }
                    
                    if (password.length < 8) {
                        alert('La contrase√±a debe tener al menos 8 caracteres.');
                        return;
                    }

                    const submitBtn  = document.getElementById('submit-button');
                    const buttonText = document.getElementById('button-text');
                    const originalText = buttonText.textContent;

                    submitBtn.disabled = true;
                    buttonText.textContent = 'Enviando...';

                    const formData = {
                        nombre:       document.getElementById('name').value,
                        email:        document.getElementById('email').value,
                        password:     document.getElementById('password').value,
                        telefono:     document.getElementById('phone').value,
                        empresa:      document.getElementById('empresa').value,
                        hectareas:    document.getElementById('hectares').value,
                        tipo_cultivo: document.getElementById('crop').value,
                        plan:         document.getElementById('plan').value,
                        roi_geojson:  window.drawnPolygonGeoJSON || null
                    };

                    // ‚ö†Ô∏è CAMBIAR EN PRODUCCI√ìN A TU WEBHOOK
                    const WEBHOOK_URL = 'http://localhost:5678/webhook/webhook-new-client';

                    try {
                        const response = await fetch(WEBHOOK_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(formData)
                        });

                        if (response.ok) {
                            alert('¬°Cuenta creada correctamente!\n\nYa puedes acceder a tu dashboard con tu email y contrase√±a.\n\nTe contactaremos pronto para activar tu monitoreo satelital.');
                            newForm.reset();
                            document.getElementById('calculated-hectares').value = '';
                            document.getElementById('hectares').value = '0';
                            window.drawnPolygonGeoJSON = null;
                        } else {
                            throw new Error('Error en el servidor: ' + response.status);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al enviar la solicitud. Por favor, int√©ntalo de nuevo o contacta con info@muorbita.com');
                    } finally {
                        submitBtn.disabled = false;
                        buttonText.textContent = originalText;
                    }
                });

            } catch (e) {
                console.error('Error Stripe:', e);
            }
        }
    </script>
</body>
</html>

